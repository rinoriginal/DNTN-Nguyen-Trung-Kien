_.mixin(_.extend(s.exports(),{"switch":function(n,t,i){return i[t.indexOf(n)]},Tags:function(n){var t="";return _.each(n,function(n){if(!_.has(n,"tag")||_.isEmpty(n)||_.isUndefined(n)||_.isNull(n))return t;var i=_.has(n,"data")?_.map(n.data,function(n,t){return"data-"+t+'="'+n+'"'}):null,r=_.has(n,"attr")?_.map(n.attr,function(n,t){return t+"="+_.quote(n)+""}):null,u=_.has(n,"sattr")?n.sattr.join(" "):"",f=_.has(n,"tooltip")?'data-container="'+(n.tooltip.container||"body")+'" data-placement="'+(n.tooltip.placement||"top")+'" data-original-title="'+(n.tooltip.text||"")+'"':"";t+="<"+n.tag+" "+f+" "+(_.isNull(r)?"":r.join(" "))+" "+(_.isNull(i)?"":i)+u+">";_.has(n,"childs")&&!_.isEmpty(_.compact(n.childs))&&(t+=_.Tags(n.childs));t+=(n.content||"")+(_.has(n,"notend")?"":"<\/"+n.tag+">")}),_.clean(t)}}));jQuery(document).ready(function(n){var t,u,r,i;n(this).off("click","button#btn-save-ticket");t=function(){n("#ticket-accordion .dropdown-menu.inner li:first-child .text,#ticket-accordion .filter-option").each(function(t,i){var r=n(i);_.isEqual(r.text(),"---- Ch\u1ecdn ----")&&(r.closest("a").addClass("text-center text-muted").find(".check-mark").remove(),r.addClass("text-center"))})};u=function(n,t,i){var f=t||new FormData,e;for(var r in n)n.hasOwnProperty(r)&&(e=i?i+"["+r+"]":r,typeof n[r]!="object"||n[r]instanceof File?f.append(e,n[r]):u(n[r],f,r));return f};n.fn.serializeObject=function(){var t={},i=this.serializeArray();return n.each(i,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t};r="";i=document.location.search.replace(/(^\?)/,"").split("&").map(function(n){return n=n.split("="),this[n[0]]=n[1],this}.bind({}))[0];n("#ticket-accordion .panel-heading .panel-title a").on("click",function(t){n(this).parents(".panel").children(".panel-collapse").hasClass("in")&&(t.preventDefault(),t.stopPropagation())});n(".selectpicker").selectpicker({container:"body"});n(".date-time-picker").datetimepicker({locale:"vi"});n(".date-picker").datetimepicker({locale:"vi",format:"DD/MM/YYYY"});n(this).on("change","#edit-ReasonCategoy",function(){var r=n(this).val(),i=_.findWhere(ReasonCategoy,{_id:r});if(n("#edit-Reason").html('<option value="">---- Ch\u1ecdn ----<\/option>').selectpicker("refresh"),!i){t();return}_.each(i.Reason,function(t){n("#edit-Reason").append('<option data-type="ticketReason" value="'+t._id+'" style="font-weight: bold">'+t.name+"<\/option>");t.subReason.length&&_.each(t.subReason,function(i){n("#edit-Reason").append('<option data-type="ticketSubreason" data-parent="'+t._id+'" value="'+i._id+'" style="text-indent: 5px">'+i.name+"<\/option>")})});n("#edit-Reason").selectpicker("refresh");t()});n(this).on("change","#filter-ReasonCategoy",function(){var r=n(this).val(),i=_.findWhere(ReasonCategoy,{_id:r});if(n("#filter-Reason").html('<option value="">---- Ch\u1ecdn ----<\/option>').selectpicker("refresh"),!i){t();return}_.each(i.Reason,function(t){n("#filter-Reason").append('<optio data-type="ticketReason" value="'+t._id+'" style="font-weight: bold"n>'+t.name+"<\/option>");t.subReason.length&&_.each(t.subReason,function(i){n("#filter-Reason").append('<option data-type="ticketSubreason" data-parent="'+t._id+'" value="'+i._id+'" style="text-indent: 5px">'+i.name+"<\/option>")})});n("#filter-Reason").selectpicker("refresh");t()});n(this).on("change",".modal #ticketReasonCategory",function(){var r=n(this).val(),i=_.findWhere(ReasonCategoy,{_id:r});if(n(".modal #ticketReason").html('<option value="">---- Ch\u1ecdn ----<\/option>').selectpicker("refresh"),!i){t();return}_.each(i.Reason,function(t){n(".modal #ticketReason").append('<option data-type="ticketReason" value="'+t._id+'" style="font-weight: bold">'+t.name+"<\/option>");t.subReason.length&&_.each(t.subReason,function(i){n(".modal #ticketReason").append('<option data-type="ticketSubreason" data-parent="'+t._id+'" value="'+i._id+'" style="text-indent: 5px">'+i.name+"<\/option>")})});n(".modal #ticketReason").selectpicker("refresh");t()});n(this).on("click","button#btn-save-ticket",function(){var t=_.pick(n("form.panel-body").serializeObject(),_.identity),f;n("body > .page-loader").show();f=n(this);async.waterfall([function(i){n.ajax({url:"/customer",method:"POST",data:u(t),cache:!1,contentType:!1,processData:!1}).done(function(n){_.isEqual(n.message,"B\u1eaft bu\u1ed9c nh\u1eadp S\u1ed1 \u0110i\u1ec7n Tho\u1ea1i ho\u1eb7c E-Mail !")?i(n.message,null):i(null,n.customer)})},function(e,o){r=e._id;async.parallel({customer:function(f){n.ajax({url:"/customer/"+r,method:"PUT",data:u(_.pick(_.omit(t,"_id"),_.identity)),cache:!1,contentType:!1,processData:!1}).done(function(r){if(_.isEqual(r.code,500))f(r.message,null);else{var u=_.capitalize(i.type)+"Container";(_.has(window.parent,u)||_.has(window.parent[u],"updatedCustomer"))&&window.parent[u].updatedCustomer({dialog:i.dialogId,customer:_.extend(t,e,r.customer)});_.each(_.extend(t,e,r.customer),function(t,i){n('[name="'+i+'"]').val(t)});f(null,r.customer)}})},ticket:function(t){var r=n("#edit-Reason option:selected"),o=n("#edit-Assign option:selected"),s={idCustomer:e._id,ticketReasonCategory:n("#edit-ReasonCategoy option:selected").val()||"",ticketReason:(_.isEqual(r.data("type"),"ticketReason")?r.val():r.data("parent"))||"",ticketSubreason:(_.isEqual(r.data("type"),"ticketReason")?"":r.val())||"",note:n("#edit-Note").val()||"",idAgent:(_.isEqual(o.data("type"),"idAgent")?o.val():"")||"",groupId:(_.isEqual(o.data("type"),"groupId")?o.val():"")||"",deadline:n("#edit-deadline").val(),type:i.type};s.status=parseInt(n("#edit-status").val())||0;n.ajax({url:"/ticket/"+f.data("ticket-id"),method:"PUT",data:u(s),cache:!1,contentType:!1,processData:!1}).done(function(n){t(null,n)})}},o)}],function(t){t?swal({title:t,type:"error"}):swal({title:"C\u1eadp nh\u1eadt th\u00e0nh c\u00f4ng !",type:"success"});n("body > .page-loader").hide()})});n(this).on("click","button#btn-search-ticket",function(){if(!r){swal({title:"Th\u00f4ng b\u00e1o",text:"Ch\u01b0a c\u00f3 th\u00f4ng tin kh\u00e1ch h\u00e0ng !",type:"info"});return}n("body > .page-loader").show();var t=_.pick(_.extend(n("#tab-old-ticket > form").serializeObject(),{type:i.type,idCustomer:r,_id:{$ne:n("#btn-save-ticket").data("ticket-id")}}),_.identity);n.get("/ticket?"+n.param(t),function(t){var i=n("#tab-old-ticket .table tbody");i.empty();_.isEqual(t.code,200)&&_.each(t.ticket,function(n){var t=_.has(n,"ticketReason")?n.ticketReason.name:"";_.has(n,"ticketSubreason")&&_.has(n.ticketSubreason,"name")&&(t=n.ticketSubreason.name);i.append(_.Tags([{tag:"tr",attr:{"class":"text-center"},childs:[{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:n.ticketReasonCategory?n.ticketReasonCategory.name:""},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:t},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:n.note||""},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:_.switch(n.status,[-1,0,1,2],["Kh\u00f4ng x\u1eed l\u00fd","Ch\u1edd x\u1eed l\u00fd","\u0110ang x\u1eed l\u00fd","Ho\u00e0n th\u00e0nh"])},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:n.deadline?moment(n.deadline).format("DD/MM/YYYY"):"N/A"},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:n.updateBy?n.updateBy.displayName:""},{tag:"td",attr:{"class":"p-t-4 p-b-4"},content:n.updated?moment(n.updated).format("DD/MM/YYYY"):"N/A"},{tag:"td",childs:[{tag:"button",attr:{"class":"btn btn-default btn-xs btn-view",type:"button",id:n._id},childs:[{tag:"i",attr:{"class":"zmdi zmdi-eye"}}]}]}]}]))});n("body > .page-loader").hide()})});n(this).on("click","button.btn-view",function(){var t=n(this).attr("id");n.get("/ticket?"+n.param({detail:!0,_id:t,type:i.type,idCustomer:r}),function(t){if(_.isEqual(t.code,200)){var r=n(".modal #ticketReasonCategory"),i=n(".modal #ticketReason");async.waterfall([function(u){if(r.val(""),i.html('<option value="">---- Ch\u1ecdn ----<\/option>'),n(".modal #deadline").val(moment(t.ticket.deadline).format("DD/MM/YYYY HH:mm")),n(".modal select#status").selectpicker("val",t.ticket.status.toString()),n(".modal #edit-Note").val(t.ticket.note),n('.modal select#status option[value="'+t.ticket.status.toString()+'"]').attr("selected",!0).siblings().removeAttr("selected"),_.has(t.ticket,"groupId")&&!_.isNull(t.ticket.groupId)&&n(".modal #edit-Assign").selectpicker("val",_.trim(t.ticket.groupId.toString())),_.has(t.ticket,"idAgent")&&!_.isNull(t.ticket.idAgent)&&n(".modal #edit-Assign").selectpicker("val",_.trim(t.ticket.idAgent.toString())),t.ticket.ticketReasonCategory){r.val(t.ticket.ticketReasonCategory._id);var f=_.findWhere(ReasonCategoy,{_id:t.ticket.ticketReasonCategory._id});_.each(f.Reason,function(n){i.append('<option data-type="ticketReason" value="'+n._id+'" style="font-weight: bold" >'+n.name+"<\/option>");n.subReason.length&&_.has(t.ticket,"ticketSubreason")&&_.each(n.subReason,function(t){i.append('<option data-type="ticketSubreason" data-parent="'+n._id+'" value="'+t._id+'" style="text-indent: 5px"  >'+t.name+"<\/option>")})});_.has(t.ticket,"ticketReason")&&i.val(t.ticket.ticketReason._id);_.has(t.ticket,"ticketSubreason")&&i.val(t.ticket.ticketSubreason._id);u(null)}else u(null)},function(n){n(null)}],function(){r.selectpicker("refresh");i.selectpicker("refresh");n("#myModal").modal("show")})}})});n(this).on("click",".modal button.btn-primary",function(){swal({title:"C\u1eadp nh\u1eadt th\u00e0nh c\u00f4ng !",type:"info"})});t();n("body > .page-loader").hide();_.has(window.parent,"setTicketId")&&window.parent.setTicketId(i.type,i.dialogId,n("#btn-save-ticket").data("ticket-id"))});