<%-breadcrumb%>
<div class="card">
    <div class="lv-header-alt clearfix m-b-5">
        <h2 class="lvh-label hidden-xs">Danh sách nhóm khách hàng</h2>
        <div class="lvh-search">
            <input type="text" placeholder="Start typing..." class="lvhs-input">
            <i class="lvh-search-close">×</i>
        </div>

        <ul class="lv-actions actions">
            <li class="dropdown" data-toggle="tooltip" data-placement="top" data-original-title="Tạo nhóm mới">
                <a role="button" data-toggle="modal" href="#frm-group">
                    <i class="zmdi zmdi-plus"></i>
                </a>
            </li>
            <li><a href="/#customer-groups" data-toggle="tooltip" data-placement="top" data-original-title="Refresh"><i class="zmdi zmdi-refresh"></i></a></li>
        </ul>
    </div>
    <div class="card-body table-responsive" style="min-height: 500px">
        <form id="customer-group">
            <table class="table table-fix">
                <thead>
                <tr>
                    <th class="text-center bgm-orange c-white w-100">Tổng</th>
                    <th data-sort="none" role="button" class="text-center bgm-orange c-white" data-field="group">Nhóm</th>
                    <th data-sort="none" role="button" class="text-center bgm-orange c-white" data-field="group">Nguồn</th>
                    <th class="text-center bgm-orange c-white w-140 text-nowrap">Khách hàng</th>
                </tr>
                </thead>
                <tbody>
                <% for(var i = 0; i < groups.length; i++){ %>
                <% var _class = (i % 2 == 0) ? 'odd' : 'even'; %>
                <tr>
                    <td rowspan="<%- groups[i].sources.length > 0 ? groups[i].sources.length : 1 %>" class="text-center <%- _class %>"><%- groups[i].totals %></td>
                    <td rowspan="<%- groups[i].sources.length > 0 ? groups[i].sources.length : 1 %>" class="text-center <%- _class %>">
                        <div class="p-relative  text-justify" style="height: <%- groups[i].sources.length * 38 - 16 %>px">
                            <div data-id="<%- groups[i]._id %>" data-url="/customer-groups" class="group-task customer-group bgm-white p-absolute r-0 t--3">
                                <a role="button" class="p-t-3 btn-flat-bg add" data-toggle="tooltip" data-placement="top" data-original-title="Thêm nguồn"><i class="zmdi zmdi-plus blue f-20"></i></a>
                                <a role="button" class="p-t-3 btn-flat-bg edit" data-toggle="tooltip" data-placement="top" data-original-title="Sửa nhóm"><i class="zmdi zmdi-edit green f-17"></i></a>
                                <a role="button" class="p-t-3 btn-flat-bg delete" data-toggle="tooltip" data-placement="top" data-original-title="Xoá nhóm"><i class="zmdi zmdi-close red f-17"></i></a>
                            </div>
                            <div class="text-capitalize d-tbl">
                                <div class="d-cell"><%- groups[i].name %></div>
                            </div>
                        </div>
                    </td>
                    <td class="text-capitalize inlineEditButton <%- _class %>">
                        <% if(groups[i].sources.length){ %>
                        <div class="p-relative text-justify">
                            <%- groups[i].sources[0].name %>
                            <div data-id="<%- groups[i].sources[0]._id %>" data-url="/customer-sources" class="group-task customer-source bgm-white p-absolute r-0 t--1 p-l-10">
                                <div class="dropdown p-relative" style="display: inline-block" data-toggle="tooltip" data-placement="top" data-original-title="Thêm khách hàng vào nhóm">
                                    <a role="button" class="t--1 p-t-3 btn-flat-bg add" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><i class="zmdi zmdi-plus blue f-20"></i></a>
                                    <ul class="dropdown-menu pull-right">
                                        <li><a href="/#customer/new"><i class="fa fa-user-plus m-r-5"></i>Trực tiếp</a></li>
                                        <li><a href="/#customer-import"><i class="fa fa-file-excel-o m-r-10"></i>Từ nguồn excel</a></li>
                                    </ul>
                                </div>
                                <a role="button" class="p-t-3 btn-flat-bg edit" data-toggle="tooltip" data-placement="top" data-original-title="Sửa nguồn"><i class="zmdi zmdi-edit green f-17"></i></a>
                                <a role="button" class="p-t-3 btn-flat-bg delete" data-toggle="tooltip" data-placement="top" data-original-title="Xoá nguồn"><i class="zmdi zmdi-close red f-17"></i></a>
                            </div>
                        </div>
                        <% } %>
                    </td>
                    <td class="50 <%- _class %>"><%- groups[i].sources.length ? '<i class="zmdi zmdi-account"></i> ' + groups[i].sources[0].amount : '' %></td>
                </tr>
                <% for(var j = 1; j < groups[i].sources.length; j++){ %>
                <tr>
                    <td class="text-capitalize inlineEditButton <%- _class %>">
                        <div class="p-relative text-justify">
                            <%- groups[i].sources[j].name %>
                            <div data-id="<%- groups[i].sources[j]._id %>" data-url="/customer-sources" class="group-task customer-source bgm-white p-absolute r-0 t--1 p-l-10">
                                <div class="dropdown p-relative" style="display: inline-block" data-toggle="tooltip" data-placement="top" data-original-title="Thêm khách hàng vào nhóm">
                                    <a role="button" class="t--1 p-t-3 btn-flat-bg add" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><i class="zmdi zmdi-plus blue f-20"></i></a>
                                    <ul class="dropdown-menu pull-right">
                                        <li><a href="/#customer/new"><i class="fa fa-user-plus m-r-5"></i>Trực tiếp</a></li>
                                        <li><a href="/#customer-import"><i class="fa fa-file-excel-o m-r-10"></i>Từ nguồn excel</a></li>
                                    </ul>
                                </div>
                                <a role="button" class="p-t-3 btn-flat-bg edit" data-toggle="tooltip" data-placement="top" data-original-title="Sửa nguồn"><i class="zmdi zmdi-edit green f-17"></i></a>
                                <a role="button" class="p-t-3 btn-flat-bg delete" data-toggle="tooltip" data-placement="top" data-original-title="Xoá nguồn"><i class="zmdi zmdi-close red f-17"></i></a>
                            </div>
                        </div>
                    </td>
                    <td class="50 <%- _class %>"><i class="zmdi zmdi-account"></i> <%- groups[i].sources[j].amount %></td>
                </tr>
                <% } %>
                <% } %>
                </tbody>
            </table>
            <%- include ('../paging.ejs') %>
        </form>
    </div>
</div>

<div class="modal fade" id="frm-group" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
    <form class="form-horizontal m-t-30" role="form">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Sửa nhóm</h4>
                </div>
                <div class="modal-body">

                    <div class="card-body">
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-3 control-label">Tên nhóm <span class="required">*</span></label>
                            <div class="col-sm-8">
                                <div class="fg-line">
                                    <input type="text" value="" class="form-control input-sm validate[required,ajax[GroupCheck]]" id="validate-groups-for-name" name="name" placeholder="vd : Công nghệ thông tin">
                                    <input type="hidden" value="" id="validate-groups-for-x-name">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-3 col-sm-8">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" value="1" name="status" id="status" checked>
                                        <i class="input-helper"></i>
                                        <span class="p-l-5 text-capitalize-f">Kích hoạt</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary waves-effect create">Xác nhận</button>
                    <button type="submit" class="btn btn-primary waves-effect update" style="display: none">Cập nhật</button>
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Bỏ qua</button>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="modal fade" id="frm-source" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
    <form class="form-horizontal m-t-30" role="form">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Tạo nguồn mới</h4>
                </div>
                <div class="modal-body">

                    <div class="card-body">
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-3 control-label">Tên nguồn <span class="required">*</span></label>
                            <div class="col-sm-8">
                                <div class="fg-line">
                                    <input type="text" class="form-control input-sm validate[required,ajax[SourceCheck]]" id="validate-source-for-name" name="name" placeholder="vd : Lập trình">
                                    <input type="hidden" value="" id="validate-source-for-x-name">
                                    <input type="hidden" value="" id="validate-source-for-group" name="group">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-3 col-sm-8">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" value="1" name="status" id="status" checked>
                                        <i class="input-helper"></i>
                                        <span class="p-l-5 text-capitalize-f">Kích hoạt</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary waves-effect">Xác nhận</button>
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Bỏ qua</button>
                </div>
            </div>
        </div>
    </form>
</div>
