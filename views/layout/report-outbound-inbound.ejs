<%- breadcrumb %>
<script>
    var companies = JSON.parse('<%- JSON.stringify(companies) %>');
    var services = JSON.parse('<%- JSON.stringify(services) %>');
    var campaigns = JSON.parse('<%- JSON.stringify(campaigns) %>');
</script>
<div class="card">
    <div class="panel panel-default card-filter p-t-35 p-b-8">
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">Công ty</div>
            <div class="card-filter-item-input">
                <select id="filter-company" name="filter-company" class="selectpicker input" title="- Tất cả -">
                    <option value="">- Tất cả -</option>
                    <% for(var i = 0;i < companies.length;i++){ %>
                    <option value=<%- companies[i]._id %>><%- companies[i].name %></option>
                    <% } %>
                </select>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">chiến dịch</div>
            <div class="card-filter-item-input">
                <select id="filter-campaign" name="filter-campaign" class="selectpicker input" title="- Tất cả -">
                    <option value="">- Tất cả -</option>
                    <% for(var i = 0;i < services.length;i++){ %>
                    <option value=<%- "service_"+services[i]._id %>><%- services[i].name %></option>
                    <% } %>
                    <% for(var i = 0;i < campaigns.length;i++){ %>
                    <option value=<%- "campaign_"+campaigns[i]._id %>><%- campaigns[i].name %></option>
                    <% } %>
                </select>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">agent</div>
            <div class="card-filter-item-input">
                <select id="filter-agent" name="filter-agent" class="selectpicker input" title="- Tất cả -">
                    <option value="">- Tất cả -</option>
                    <% for(var i = 0;i < agents.length;i++){ %>
                    <option value=<%- agents[i]._id %>><%- agents[i].displayName %></option>
                    <% } %>
                </select>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">từ ngày</div>
            <div class="card-filter-item-input">
                <div class="input-group">
                    <input type="text"
                           class="form-control pull-right search-field date-picker filter-campain input"
                           id="filter-start-date" name="startDate"
                           placeholder=" VD: 01/01/2018">
                            <span class="input-group-addon p-l-10 bgm-gray c-white"><i role="button"
                                                                                       class="zmdi zmdi-calendar"></i></span>
                </div>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">từ giờ</div>
            <div class="card-filter-item-input input-group">
                <input class="form-control text-center"
                       id="filter-start-hour"
                       name="filter-start-hour"
                       type="text"
                       placeholder=" VD: 12:00"
                       data-mask="00:00"
                       value="00:00"
                />
                <span class="input-group-addon p-l-10 bgm-gray c-white"><i role="button" class="zmdi zmdi-time"></i></span>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">đến ngày</div>
            <div class="card-filter-item-input">
                <div class="input-group">
                    <input type="text"
                           class="form-control pull-right search-field date-picker filter-campain input"
                           id="filter-end-date" name="filter-end-date"
                           placeholder=" VD: 01/01/2018">
                            <span class="input-group-addon p-l-10 bgm-gray c-white"><i role="button"
                                                                                       class="zmdi zmdi-calendar"></i></span>
                </div>
            </div>
        </div>
        <div class="card-filter-item">
            <div class="card-filter-item-label text-uppercase color-grey">đến giờ</div>
            <div class="card-filter-item-input input-group">
                <input class="form-control text-center"
                       id="filter-end-hour"
                       name="filter-end-hour"
                       type="text"
                       placeholder=" VD: 12:00"
                       data-mask="00:00"
                       value="23:00"
                />
                <span class="input-group-addon p-l-10 bgm-gray c-white"><i role="button" class="zmdi zmdi-time"></i></span>
            </div>
        </div>
        <div class="card-filter-item" style="width: 100%;">
            <div class="card-filter-item-label text-uppercase color-grey" style="opacity: 0;">search</div>
            <div class="card-filter-item-input">
                <a id="filter-btn" class="btn c-white bg-color-green" style="width:100%"><i class="fa fa-search"></i></a>
            </div>
        </div>
    </div>
</div>

<div class="card p-b-8">
    <div class="block" style="display: flex;">
        <span class="text-uppercase color-grey" style="display: flex;align-items: center; padding-left: 12px;">báo cáo tổng quát</span>
        <a id="download-excel" class="btn c-white bg-color-green" style="margin-left: auto;"><i class="fa fa-file-excel-o m-r-10"></i>Xuất Excel</a>
    </div>

    <div class="card-body table-responsive">
        <table id="table-general" class="table table-hover table-condensed table-bordered table-fix">
            <thead>
            <tr>
                <th class="bgm-orange c-white text-center text-uppercase" colspan="3" style="border-right: 1px solid rgba(220, 220, 220, 0.2) !important">outbound</th>
                <th class="bgm-orange c-white text-center text-uppercase" colspan="4">inbound</th>
            </tr>
            <tr>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">tổng số gọi ra</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">số lượng cuộc gọi kết nối</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2" style="border-right: 1px solid rgba(220, 220, 220, 0.2) !important">tổng số phiếu</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">tổng số gọi vào</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">số lượng cuộc gọi được phục vụ</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">số lượng cuộc gọi lỡ</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">tổng số phiếu</th>
            </tr>
            </thead>
            <tbody>
            <%
            function pad(num) {
                return ("0"+num).slice(-2);
            }
            function hms(secs) {
                if(isNaN(secs)) return "0:00:00";
                var sec = Math.ceil(secs);
                var minutes = Math.floor(sec / 60);
                sec = sec%60;
                var hours = Math.floor(minutes/60)
                minutes = minutes%60;
                return hours+":"+pad(minutes)+":"+pad(sec);
            }%>
            <tr role="button" class="text-center filter-detail">
                <td><%- data.outbound_total%></td>
                <td><%- data.outbound_connected%></td>
                <td><%- data.outbound_tickets%></td>
                <td><%- data.inbound_total%></td>
                <td><%- data.inbound_connected%></td>
                <td><%- data.inbound_missing%></td>
                <td><%- data.inbound_tickets%></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="card p-b-8">
    <div class="block" style="display: flex;">
        <span class="text-uppercase color-grey" style="display: flex;align-items: center; padding-left: 12px;">báo cáo chi tiết</span>
        <a id="download-excel-detail" class="btn c-white bg-color-green" style="margin-left: auto;"><i class="fa fa-file-excel-o m-r-10"></i>Xuất Excel</a>
    </div>

    <div class="card-body table-responsive">
        <table id="table-detail" class="table table-hover table-condensed table-bordered table-fix">
            <thead>
            <tr>
                <th class="bgm-orange c-white text-center text-uppercase" colspan="1"></th>
                <th class="bgm-orange c-white text-center text-uppercase" colspan="3" style="border-right: 1px solid rgba(220, 220, 220, 0.2) !important;border-left: 1px solid rgba(220, 220, 220, 0.2) !important">outbound</th>
                <th class="bgm-orange c-white text-center text-uppercase" colspan="4">inbound</th>
            </tr>
            <tr>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2" style="border-right: 1px solid rgba(220, 220, 220, 0.2) !important">điện thoại viên</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">tổng số cuộc gọi</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">thời gian đàm thoại</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2" style="border-right: 1px solid rgba(220, 220, 220, 0.2) !important">thời gian đàm thoại tb</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">số lượng cuộc gọi kết nối</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">thời gian chờ</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">thời lượng đàm thoại</th>
                <th class="bgm-orange c-white text-center text-uppercase" rowspan="2">thời lượng đàm thoại tb</th>
            </tr>
            </thead>
            <tbody>
            <% if(!!dataDetail){ %>
            <%for(var i = 0; i < dataDetail.length;i++){%>
            <tr class="text-center">
                <td><%- dataDetail[i].agent%></td>
                <td><%- dataDetail[i].outbound_total%></td>
                <td><%- hms(dataDetail[i].outbound_call_duration/1000)%></td>
                <td><%- hms(dataDetail[i].outbound_avg_call_duration/1000)%></td>
                <td><%- dataDetail[i].inbound_connect%></td>
                <td><%- hms(dataDetail[i].inbound_wait_duration/1000)%></td>
                <td><%- hms(dataDetail[i].inbound_call_duration/1000)%></td>
                <td><%- hms(dataDetail[i].inbound_avg_call_duration/1000)%></td>
            </tr>
            <%}%>
            <% } %>
            </tbody>
        </table>
        <% if(!!pagingDetail && pagingDetail.totalResult > 0){ %>
        <div class="text-center p-t-20" id="report-total">
            <b>
                <span>Tổng</span>
                <span class="bold c-red"><%- pagingDetail.totalResult%></span>
            </b>
        </div>
        <% include ../pagingDetail.ejs %>
        <% } %>
    </div>

</div>